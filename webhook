local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Configuration
local WEBHOOK_URL = "https://discord.com/api/webhooks/1437114096511221790/0odcPwZ2rAA2hG2roA5YLmDWJSO0KvSHJeTaFgYYkPjAbwObUDogwDVcMknx-BlZV8fi" -- Replace with your Discord webhook ngr

-- Function to get the player's current island
local function getPlayerIsland()
    local character = LocalPlayer.Character
    if not character then return "Unknown Island" end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return "Unknown Island" end
    
    local Islands = game.Workspace:FindFirstChild("Islands")
    if not Islands then return "Unknown Island" end
    
    -- Check which island folder the player is in
    for _, island in pairs(Islands:GetChildren()) do
        if island:IsA("Folder") then
            -- Check if player's character is a descendant of this island
            if humanoidRootPart:IsDescendantOf(island) then
                return island.Name
            end
            
            -- Alternative: Check by proximity to island bounds
            -- This helps if the character isn't directly parented to the island
            local islandRegion = island:FindFirstChild("IslandRegion") or island:FindFirstChild("Region")
            if islandRegion and islandRegion:IsA("BasePart") then
                local distance = (humanoidRootPart.Position - islandRegion.Position).Magnitude
                local size = islandRegion.Size.Magnitude
                if distance < size then
                    return island.Name
                end
            end
        end
    end
    
    return "Unknown Island"
end

-- Function to send webhook notification
local function sendAnimalWebhook(animalName, island, bodyVariant, maneVariant, tailVariant, hornVariant)
    local data = {
        ["content"] = "@everyone **UNBREEDABLE ANIMAL DETECTED!**",
        ["embeds"] = {{
            ["title"] = "Rare horse found!",
            ["description"] = "Stats of the caught horse:",
            ["color"] = 16716947, -- hot pink color
            ["fields"] = {
                {
                    ["name"] = "Horse Breed",
                    ["value"] = animalName,
                    ["inline"] = false
                },
                {
                    ["name"] = "Island",
                    ["value"] = island,
                    ["inline"] = true
                },
                {
                    ["name"] = "Player",
                    ["value"] = LocalPlayer.Name,
                    ["inline"] = true
                },
                {
                    ["name"] = "Coat",
                    ["value"] = bodyVariant,
                    ["inline"] = true
                },
                {
                    ["name"] = "Mane Color",
                    ["value"] = maneVariant,
                    ["inline"] = true
                },
                {
                    ["name"] = "Tail Color",
                    ["value"] = tailVariant,
                    ["inline"] = true
                },
                {
                    ["name"] = "Horn Variant",
                    ["value"] = hornVariant,
                    ["inline"] = true
                }
            },
            ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%S")
        }}
    }
    
    print("ðŸ”” Attempting to send webhook...")
    print("  Webhook URL: " .. (WEBHOOK_URL ~= "YOUR_WEBHOOK_URL_HERE" and "Configured" or "NOT CONFIGURED"))
    
    local success, err = pcall(function()
        local response = syn and syn.request or http_request or request
        print("  Using request function: " .. (response and "Found" or "NOT FOUND"))
        
        if response then
            local result = response({
                Url = WEBHOOK_URL,
                Method = "POST",
                Headers = {
                    ["Content-Type"] = "application/json"
                },
                Body = HttpService:JSONEncode(data)
            })
            print("  Request result: " .. tostring(result))
        else
            print("  Falling back to HttpService")
            HttpService:PostAsync(WEBHOOK_URL, HttpService:JSONEncode(data), Enum.HttpContentType.ApplicationJson)
        end
    end)
    
    if success then
        print("âœ… Webhook sent successfully for: " .. animalName)
    else
        warn("âŒ Failed to send webhook: " .. tostring(err))
    end
end

-- Function to check the animal information GUI
local function checkAnimalInfo()
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    local subMenus = playerGui:WaitForChild("SubMenus")
    local itemInfo = subMenus:WaitForChild("Item Information")
    local animals = itemInfo:WaitForChild("Animals")
    
    if not animals.Visible then return end
    
    print("ðŸ” Animal GUI became visible, checking...")
    
    -- Wait a moment for GUI to fully load
    task.wait(0.1)
    
    local main = animals:FindFirstChild("Main")
    if not main then 
        warn("Main not found")
        return 
    end
    
    local content = main:FindFirstChild("Content")
    if not content then 
        warn("Content not found")
        return 
    end
    
    local top = content:FindFirstChild("Top")
    if not top then 
        warn("Top not found")
        return 
    end
    
    local labels = top:FindFirstChild("Labels")
    if not labels then 
        warn("Labels not found")
        return 
    end
    
    -- Check if unbreedable
    local indicatorLabel = labels:FindFirstChild("IndicatorLabel")
    if not indicatorLabel then 
        warn("IndicatorLabel not found")
        return 
    end
    
    print("  Indicator text: " .. indicatorLabel.Text)
    
    if not string.find(indicatorLabel.Text, "Unbreedable") then
        print("  âŒ Not unbreedable, skipping")
        return
    end
    
    print("  âœ… Unbreedable detected!")
    
    -- Get animal name
    local nameLabel = labels:FindFirstChild("NameLabel")
    local animalName = nameLabel and nameLabel.Text or "Unknown"
    print("  Animal Name: " .. animalName)
    
    -- Get variants
    local middle = content:FindFirstChild("Middle")
    if not middle then 
        warn("Middle not found")
        return 
    end
    
    local middleTop = middle:FindFirstChild("Top")
    if not middleTop then 
        warn("Middle Top not found")
        return 
    end
    
    local variantsFrame = middleTop:FindFirstChild("VariantsFrame")
    if not variantsFrame then 
        warn("VariantsFrame not found")
        return 
    end
    
    -- Get Body Variant
    local bodyVariant = "Unknown"
    local bodyVariantFrame = variantsFrame:FindFirstChild("BodyVariant")
    if bodyVariantFrame then
        local right = bodyVariantFrame:FindFirstChild("Right")
        if right then
            local colourLabel = right:FindFirstChild("ColourLabel")
            if colourLabel then
                bodyVariant = colourLabel.Text
            end
        end
    end
    print("  Body Variant: " .. bodyVariant)
    
    -- Get Mane Variant
    local maneVariant = "Unknown"
    local maneVariantsFrame = variantsFrame:FindFirstChild("ManeVariants")
    if maneVariantsFrame then
        local right = maneVariantsFrame:FindFirstChild("Right")
        if right then
            local originalLabel = right:FindFirstChild("OriginalLabel")
            if originalLabel then
                maneVariant = originalLabel.Text
            end
        end
    end
    print("  Mane Variant: " .. maneVariant)
    
    -- Get Tail Variant
    local tailVariant = "Unknown"
    local tailVariantsFrame = variantsFrame:FindFirstChild("TailVariants")
    if tailVariantsFrame then
        local right = tailVariantsFrame:FindFirstChild("Right")
        if right then
            local originalLabel = right:FindFirstChild("OriginalLabel")
            if originalLabel then
                tailVariant = originalLabel.Text
            end
        end
    end
    print("  Tail Variant: " .. tailVariant)
    
    -- Get Horn Variant
    local hornVariant = "N/A"
    local hornVariantsFrame = variantsFrame:FindFirstChild("HornVariants")
    if hornVariantsFrame and hornVariantsFrame.Visible then
        local right = hornVariantsFrame:FindFirstChild("Right")
        if right then
            local originalLabel = right:FindFirstChild("OriginalLabel")
            if originalLabel then
                hornVariant = originalLabel.Text
            end
        end
    end
    print("  Horn Variant: " .. hornVariant)
    
    -- Get player's current island
    local currentIsland = getPlayerIsland()
    print("  Current Island: " .. currentIsland)
    
    -- Send webhook
    print("ðŸ”¥ FOUND UNBREEDABLE ANIMAL: " .. animalName)
    sendAnimalWebhook(animalName, currentIsland, bodyVariant, maneVariant, tailVariant, hornVariant)
end

-- Monitor the Animals GUI for visibility changes
local function setupMonitoring()
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    local subMenus = playerGui:WaitForChild("SubMenus")
    local itemInfo = subMenus:WaitForChild("Item Information")
    local animals = itemInfo:WaitForChild("Animals")
    
    -- Check when GUI becomes visible
    animals:GetPropertyChangedSignal("Visible"):Connect(function()
        if animals.Visible then
            checkAnimalInfo()
        end
    end)
    
    print("ðŸ‘ï¸ Monitoring Animal Information GUI for unbreedable animals!")
end

-- Start monitoring
setupMonitoring()
