-- Auto Lasso Throw Script
-- Works by ngr
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- Configuration
local CHECK_INTERVAL = 0.2
local AUTO_THROW_RANGE = 25
local THROW_COOLDOWN = 1.5

-- State
local lastThrowTime = 0
local running = true

-- Get References module
local References = ReplicatedStorage:WaitForChild("References")

-- Function to check if model is valid target (has HumanoidRootPart and ManeMesh)
local function isValidTarget(model)
	if not model or not model:IsA("Model") then return false end
	
	local hrp = model:FindFirstChild("HumanoidRootPart")
	if not hrp then return false end
	
	-- Check for ManeMesh anywhere in the model
	for _, child in pairs(model:GetDescendants()) do
		if child.Name == "ManeMesh" then
			return true, hrp
		end
	end
	
	return false
end

-- Function to get closest valid target
local function getClosestHorse()
	local character = player.Character
	if not character then return nil end
	
	local rootPart = character:FindFirstChild("HumanoidRootPart")
	if not rootPart then return nil end
	
	local closestHorse = nil
	local closestDistance = math.huge
	
	-- Check all models in workspace
	for _, obj in pairs(workspace:GetChildren()) do
		local isValid, targetHRP = isValidTarget(obj)
		
		if isValid and targetHRP then
			local distance = (rootPart.Position - targetHRP.Position).Magnitude
			
			if distance <= AUTO_THROW_RANGE and distance < closestDistance then
				closestHorse = obj
				closestDistance = distance
			end
		end
	end
	
	return closestHorse, closestDistance
end

-- Function to get equipped lasso
local function getEquippedLasso()
	local character = player.Character
	if not character then return nil end
	
	-- Check for equipped tool
	local tool = character:FindFirstChildOfClass("Tool")
	if not tool then return nil end
	
	-- Check if it's a lasso (by name)
	if tool.Name:lower():find("lasso") or tool.Name:lower():find("rope") then
		return tool
	end
	
	return nil
end

-- Function to get equipment object from tool
local function getEquipmentObject(tool)
	-- Try to find the equipment handler in PlayerScripts
	local playerScripts = player:WaitForChild("PlayerScripts")
	
	-- Look for Equipment handler
	local success, equipmentHandler = pcall(function()
		return require(playerScripts:WaitForChild("Priority"):WaitForChild("Equipment"))
	end)
	
	if success and equipmentHandler then
		-- Try to get the active equipment
		if equipmentHandler.equipped then
			return equipmentHandler.equipped
		end
	end
	
	return nil
end

-- Function to activate lasso
local function activateLasso()
	local tool = getEquippedLasso()
	if not tool then return false end
	
	-- Method 1: Try to call equipment activation directly
	local equipmentObj = getEquipmentObject(tool)
	if equipmentObj then
		local success = pcall(function()
			equipmentObj:Activate()
		end)
		if success then
			return true
		end
	end
	
	-- Method 2: Try tool activation
	pcall(function()
		tool:Activate()
	end)
	
	-- Method 3: Simulate mouse click
	local success = false
	pcall(function()
		mouse1click()
		success = true
	end)
	
	if not success then
		pcall(function()
			mouse1press()
			task.wait(0.05)
			mouse1release()
			success = true
		end)
	end
	
	return success
end

-- Main loop
local function autoThrowLoop()
	print("ðŸŽ¯ Auto Lasso Throw started!")
	print("ðŸ“ Range: " .. AUTO_THROW_RANGE .. " studs")
	print("â±ï¸ Cooldown: " .. THROW_COOLDOWN .. " seconds")
	print("ðŸ” Looking for models with HumanoidRootPart + ManeMesh")
	print("=====================================")
	
	while running do
		task.wait(CHECK_INTERVAL)
		
		local currentTime = tick()
		
		-- Check cooldown
		if currentTime - lastThrowTime < THROW_COOLDOWN then
			continue
		end
		
		-- Check if lasso is equipped
		local lasso = getEquippedLasso()
		if not lasso then
			continue
		end
		
		-- Get closest target
		local target, distance = getClosestHorse()
		
		if target then
			print("ðŸ´ Found target: " .. target.Name .. " at " .. math.floor(distance) .. " studs")
			
			-- Activate lasso
			if activateLasso() then
				lastThrowTime = currentTime
				print("âœ… Lasso activated!")
			else
				print("âš ï¸ Failed to activate lasso")
			end
		end
	end
end

-- Start
task.spawn(autoThrowLoop)

-- Stop function
getgenv().StopAutoLasso = function()
	running = false
	print("ðŸ›‘ Auto Lasso Throw stopped!")
end

print("âœ… AUTO LASSO SCRIPT LOADED")
print("ðŸ’¡ Run 'StopAutoLasso()' to stop")
print("ðŸ’¡ Make sure lasso is equipped!")
