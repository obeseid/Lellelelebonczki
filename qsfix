-- fffffff

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local itemInfoFrame = playerGui:WaitForChild("SubMenus"):WaitForChild("Item Information")
local indicatorLabel = itemInfoFrame.Animals.Main.Content.Top.Labels.IndicatorLabel
local closeButton = itemInfoFrame.Animals.Main.CloseMenu
local buttonsContainer = itemInfoFrame.Animals.Main.Content.Buttons

local TARGET_IMAGE_ID = "rbxassetid://13116451197"
local isProcessing = false -- Debounce flag

-- Function to click a button using the executor logic
local function clickButton(button)
	if not button:IsA("TextButton") and not button:IsA("ImageButton") then
		return
	end
	
	-- Fire MouseButton1Down
	for _, connection in pairs(getconnections(button.MouseButton1Down)) do
		connection:Fire()
	end
	task.wait(0.05)
	
	-- Fire MouseButton1Up
	for _, connection in pairs(getconnections(button.MouseButton1Up)) do
		connection:Fire()
	end
	task.wait(0.05)
	
	-- Fire Activated
	for _, connection in pairs(getconnections(button.Activated)) do
		connection:Fire()
	end
end

-- VIM function for clicking the Yes button
local function clickYesButtonVIM(button)
	if not button:IsA("TextButton") and not button:IsA("ImageButton") then
		return
	end
	
	print("Clicking Yes button with VirtualInputManager")
	
	local VirtualInputManager = game:GetService("VirtualInputManager")
	
	-- Get button position
	local buttonPos = button.AbsolutePosition
	local buttonSize = button.AbsoluteSize
	local centerX = buttonPos.X + (buttonSize.X / 2)
	local centerY = buttonPos.Y + (buttonSize.Y / 2) + 10  -- Added 10 pixels down
	
	print("Button center position (adjusted): X=" .. centerX .. " Y=" .. centerY)
	
	-- Simulate mouse click at button center
	VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, true, game, 0)
	task.wait(0.1)
	VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, false, game, 0)
	
	print("VIM click sent")
end

-- Function to handle when Item Information frame opens
local function onItemInfoOpened()
	-- Debounce check
	if isProcessing then
		return
	end
	
	-- Check if the frame is actually visible
	if not itemInfoFrame.Visible then
		return
	end
	
	isProcessing = true
	
	-- Wait 0.5 seconds before doing anything to avoid bugs
	task.wait(0.5)
	
	-- Check if IndicatorLabel contains "Unbreedable"
	local labelText = indicatorLabel.Text
	
	if string.find(labelText, "Unbreedable") then
		-- Contains "Unbreedable" - just close the menu and return
		print("Item is Unbreedable, closing menu")
		clickButton(closeButton)
		task.wait(1)
		isProcessing = false
		return
	end
	
	-- Does NOT contain "Unbreedable" - proceed with breeding logic
	print("Item is breedable, looking for breed button")
	
	-- Look through all OptionButtons in the Buttons container
	for _, child in ipairs(buttonsContainer:GetChildren()) do
		if child.Name == "OptionButton" then
			-- Check if it has an ImageLabel child
			local imageLabel = child:FindFirstChildWhichIsA("ImageLabel")
			if imageLabel and imageLabel.Image == TARGET_IMAGE_ID then
				print("Found breeding button, clicking it")
				clickButton(child)
				
				-- Wait 2 seconds for the prompt to fully appear
				print("Waiting 2 seconds for YesNo prompt to load...")
				task.wait(2)
				
				-- Click the Yes button with VIM
				local success, err = pcall(function()
					local prompts = playerGui:WaitForChild("Prompts", 3)
					local yesNo = prompts:WaitForChild("YesNo", 3)
					local yesButton = yesNo.Content.Frame.Yes
					
					print("Found Yes button, waiting 1 second...")
					task.wait(1)
					
					clickYesButtonVIM(yesButton)
				end)
				
				if not success then
					warn("Failed to click Yes button: " .. tostring(err))
				end
				
				break
			end
		end
	end
	
	-- Reset debounce after a delay
	task.wait(2)
	isProcessing = false
end

-- Monitor when the Item Information frame becomes visible
itemInfoFrame:GetPropertyChangedSignal("Visible"):Connect(function()
	if itemInfoFrame.Visible then
		onItemInfoOpened()
	end
end)

print("Roblox breeding automation script loaded")
