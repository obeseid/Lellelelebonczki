-- Auto Lasso Throw Script
-- UPDATE FOR FUCKS SAKE

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CollectionService = game:GetService("CollectionService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Configuration
local CHECK_INTERVAL = 0.1 -- How often to check for horses (in seconds)
local AUTO_THROW_RANGE = 5 -- Range to auto-throw (adjust based on your lasso's captureRadius)

-- State variables
local lastThrowTime = 0
local THROW_COOLDOWN = 1 -- Minimum time between throws (in seconds)

-- Function to get the closest horse in range
local function getClosestHorse()
	local closestHorse = nil
	local closestDistance = math.huge
	
	-- Get all objects tagged with "LassoCapture"
	for _, animal in pairs(CollectionService:GetTagged("LassoCapture")) do
		if animal:IsDescendantOf(workspace) then
			-- Get the animal's position
			local success, animalCFrame = pcall(function()
				return animal:GetBoundingBox()
			end)
			
			if success and animalCFrame then
				local animalPos = animalCFrame.Position
				
				-- Calculate distance from player
				local distance = (humanoidRootPart.Position - animalPos).Magnitude
				
				-- Check if in range and closer than previous closest
				if distance <= AUTO_THROW_RANGE and distance < closestDistance then
					closestHorse = animal
					closestDistance = distance
				end
			end
		end
	end
	
	return closestHorse, closestDistance
end

-- Function to check if player has lasso equipped
local function hasLassoEquipped()
	-- Check if the player's character has the lasso tool equipped
	local tool = character:FindFirstChildOfClass("Tool")
	if tool then
		-- Check if it's a lasso by name or if it has the lasso handler script
		if tool.Name:lower():find("lasso") or tool:FindFirstChild("LassoHandler") or tool:FindFirstChild("Handle") then
			return true, tool
		end
	end
	return false, nil
end

-- Function to trigger lasso throw
local function autoThrowLasso()
	local currentTime = tick()
	
	-- Check cooldown
	if currentTime - lastThrowTime < THROW_COOLDOWN then
		return
	end
	
	-- Check if lasso is equipped
	local hasLasso, lassoTool = hasLassoEquipped()
	if not hasLasso then
		return
	end
	
	-- Get closest horse
	local horse, distance = getClosestHorse()
	
	if horse then
		-- Update last throw time
		lastThrowTime = currentTime
		
		-- Activate the tool (this triggers the lasso throw)
		lassoTool:Activate()
		
		print("Auto-threw lasso at:", horse.Name, "Distance:", math.floor(distance))
	end
end

-- Main loop
local function startAutoThrow()
	while task.wait(CHECK_INTERVAL) do
		if character and character.Parent and humanoidRootPart and humanoidRootPart.Parent then
			pcall(autoThrowLasso) -- Wrap in pcall to prevent errors from breaking the loop
		else
			-- Character died or was removed, wait for respawn
			if player.Character then
				character = player.Character
				humanoidRootPart = character:WaitForChild("HumanoidRootPart", 5)
			end
		end
	end
end

-- Handle character respawn
player.CharacterAdded:Connect(function(newCharacter)
	character = newCharacter
	humanoidRootPart = character:WaitForChild("HumanoidRootPart")
	print("Character respawned - Auto lasso ready")
end)

-- Start the auto-throw system
task.spawn(startAutoThrow)

print("Auto Lasso Throw script loaded and running!")
