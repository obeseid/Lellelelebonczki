--// Player setup
local player = game.Players.LocalPlayer
local teleporting = true -- Set to true to start immediately
local teleportCoroutine

--// Function to find the model with HumanoidRootPart and tailMesh
local function findTargetModel()
	local trainingIsland = workspace:WaitForChild("Islands"):WaitForChild("Training Island")
	
	for _, model in ipairs(trainingIsland:GetDescendants()) do
		if model:IsA("Model") then
			local hasHRP = model:FindFirstChild("HumanoidRootPart")
			local hasTailMesh = model:FindFirstChild("tailMesh", true) -- Recursive search
			
			if hasHRP and hasTailMesh then
				return model
			end
		end
	end
	
	return nil
end

--// Teleport Function
local function teleportLoop()
	local character = player.Character or player.CharacterAdded:Wait()
	local hrp = character:WaitForChild("HumanoidRootPart")
	local humanoid = character:WaitForChild("Humanoid")
	
	-- Target checkpoint
	local checkpoint = workspace:WaitForChild("CheckpointMarker"):WaitForChild("Neon")
	
	-- Find the target model
	local targetModel = findTargetModel()
	if targetModel then
		print("Found target model: " .. targetModel.Name)
	else
		warn("Could not find model with HumanoidRootPart and tailMesh")
	end
	
	while teleporting do
		if checkpoint and checkpoint:IsA("BasePart") then
			local seatPart = humanoid.SeatPart
			
			if seatPart and seatPart:IsDescendantOf(workspace) then
				-- Player is on a mount or vehicle
				local mountModel = seatPart:FindFirstAncestorWhichIsA("Model")
				
				if mountModel then
					-- Temporarily anchor all parts to avoid physics glitch
					for _, part in ipairs(mountModel:GetDescendants()) do
						if part:IsA("BasePart") then
							part.Anchored = true
						end
					end
					
					local targetCFrame = checkpoint.CFrame
					if mountModel.PrimaryPart then
						mountModel:SetPrimaryPartCFrame(targetCFrame)
					else
						seatPart.CFrame = targetCFrame
					end
					
					task.wait(0.1)
					
					-- Unanchor after teleport
					for _, part in ipairs(mountModel:GetDescendants()) do
						if part:IsA("BasePart") then
							part.Anchored = false
						end
					end
				else
					-- Fallback: just move seat
					seatPart.Anchored = true
					seatPart.CFrame = checkpoint.CFrame
					task.wait(0.1)
					seatPart.Anchored = false
				end
			else
				-- Player on foot
				hrp.CFrame = checkpoint.CFrame
			end
			
			-- Teleport the target model if it exists
			if targetModel and targetModel:FindFirstChild("HumanoidRootPart") then
				local modelHRP = targetModel.HumanoidRootPart
				
				-- Anchor all parts temporarily
				for _, part in ipairs(targetModel:GetDescendants()) do
					if part:IsA("BasePart") then
						part.Anchored = true
					end
				end
				
				-- Teleport the model to checkpoint
				if targetModel.PrimaryPart then
					targetModel:SetPrimaryPartCFrame(checkpoint.CFrame)
				else
					modelHRP.CFrame = checkpoint.CFrame
				end
				
				task.wait(0.1)
				
				-- Unanchor all parts
				for _, part in ipairs(targetModel:GetDescendants()) do
					if part:IsA("BasePart") then
						part.Anchored = false
					end
				end
			end
		else
			warn("CheckpointMarker.Neon not found or is not a part")
		end
		
		task.wait(5) -- Wait 5 seconds between teleports
	end
end

--// Start teleport automatically
teleportCoroutine = coroutine.create(teleportLoop)
coroutine.resume(teleportCoroutine)
