-- LocalScript - Place inside StarterPlayer > StarterPlayerScripts or StarterGui

local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- Wait for PlayerGui
local playerGui = player:WaitForChild("PlayerGui")

-- Variables
local tradePartnerUsername = nil
local isMonitoring = false

-- Function to extract username from the title text
local function extractUsername(text)
	local username = text:match("%((.-)%)")
	return username
end

-- Function to freeze the trading GUI by cloning
local function freezeTradingGui(tradingGui)
	if not tradingGui or not tradingGui.Visible then
		return
	end
	
	print("Cloning and freezing Trading GUI for 11 seconds...")
	
	-- Clone the trading GUI immediately
	local clonedGui = tradingGui:Clone()
	
	-- Disable all interactive elements in the clone
	for _, descendant in pairs(clonedGui:GetDescendants()) do
		if descendant:IsA("GuiButton") or descendant:IsA("TextButton") or descendant:IsA("ImageButton") then
			descendant.Active = false
		end
	end
	
	-- Optional: Add visual feedback to the clone
	local header = clonedGui:FindFirstChild("Header")
	if header then
		local title = header:FindFirstChild("Title")
		if title and title:IsA("TextLabel") then
			title.Text = title.Text .. " (Player Left - Closing in 11s)"
		end
	end
	
	-- Parent the clone to PlayerGui
	clonedGui.Parent = playerGui
	clonedGui.Visible = true
	
	-- Wait 11 seconds
	task.wait(11)
	
	-- Destroy the cloned GUI
	clonedGui:Destroy()
	
	print("Cloned Trading GUI destroyed!")
end

-- Setup monitoring for the trading GUI
local function setupMonitoring()
	local menusFolder = playerGui:WaitForChild("Menus")
	local tradingGui = menusFolder:WaitForChild("Trading")
	local header = tradingGui:WaitForChild("Header")
	local titleLabel = header:WaitForChild("Title")
	
	-- Monitor when trading GUI becomes visible
	tradingGui:GetPropertyChangedSignal("Visible"):Connect(function()
		if tradingGui.Visible then
			-- Trade started, extract partner username
			tradePartnerUsername = extractUsername(titleLabel.Text)
			isMonitoring = true
			print("Trading started with:", tradePartnerUsername)
		else
			-- Trade ended
			isMonitoring = false
			tradePartnerUsername = nil
		end
	end)
	
	-- Monitor title changes
	titleLabel:GetPropertyChangedSignal("Text"):Connect(function()
		if tradingGui.Visible then
			tradePartnerUsername = extractUsername(titleLabel.Text)
		end
	end)
	
	-- Monitor players leaving
	Players.PlayerRemoving:Connect(function(leavingPlayer)
		if isMonitoring and tradePartnerUsername and leavingPlayer.Name == tradePartnerUsername then
			print("Trade partner left! Freezing GUI...")
			-- Clone the GUI before it disappears
			freezeTradingGui(tradingGui)
			isMonitoring = false
			tradePartnerUsername = nil
		end
	end)
	
	print("Trade monitoring active!")
end

-- Start monitoring
local success, err = pcall(setupMonitoring)
if not success then
	warn("Failed to setup monitoring:", err)
end
